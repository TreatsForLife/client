var Utils={isLocal:document.location.host.search("localhost")>-1||document.location.host.search("lvh.me")>-1,isBchmn:document.location.host.search("bchmn.com")>-1,isHeroku:document.location.host.search("herokuapp.com")>-1,findIdInArray:function(a,b,c){"undefined"==typeof c&&(c="_id");for(var d,e=0;d=a[e];e++)if(d[c]==b)return d;return!1}},Consts={api_root:Utils.isBchmn?"http://tfl.bchmn.com/":Utils.isHeroku?"http://treatsforlife-api.herokuapp.com/":"http://localhost:3000/",fb_app_id:Utils.isLocal?"262700727225341":"601219569953172"};angular.module("clientApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider","$compileProvider",function(a,b){b.aHrefSanitizationWhitelist(/^\s*(https?|http?|ftp|mailto|file|tel):/),a.when("/welcome",{templateUrl:"views/welcome.html",controller:"WelcomeCtrl"}).when("/pet",{templateUrl:"views/pet.html",controller:"PetCtrl"}).when("/pet/:id",{templateUrl:"views/pet.html",controller:"PetCtrl"}).when("/pets",{templateUrl:"views/pets.html",controller:"PetsCtrl"}).when("/",{templateUrl:"views/pets.html",controller:"PetsCtrl"}).otherwise({redirectTo:"/"})}]).run(["$location","$cookies",function(a,b){"/"==a.path()&&(console.log("$cookies",b.fb_user),a.path(b.fb_id&&"w"!=a.search().s?b.pet?"/pet":"/pets":"/welcome"))}]),angular.module("clientApp").controller("RootCtrl",["$scope","$rootScope",function(a,b){a.instajam=Instajam.init({clientId:"1e7c407bd22b435e8447b7607245a947",redirectUri:"http://127.0.0.1:9000",scope:["basic","comments"]}),a.instajam.user.self.profile(function(a){console.log(a)}),b.picHeight=.7*$(window).width(),b.goBack=function(){window.history.back()}}]),angular.module("clientApp").factory("Instagram",["$http",function(a){var b="https://api.instagram.com/v1",c="d9c1142d0ac14d1ea5a45bc8478006a4",d="treatsforlife";return{get:function(e){var f="/tags/"+d+"/media/recent",g=b+f,h={params:{client_id:c,count:e,callback:"JSON_CALLBACK"}},i=a.jsonp(g,h);return console.log(i),i}}}]),angular.module("clientApp").factory("Pets",["$resource",function(a){return a(Consts.api_root+"pet/:id",{},{all:{method:"GET",withCredentials:!0,params:{},isArray:!0},query:{method:"GET",withCredentials:!0,params:{},isArray:!1},create:{method:"POST"},update:{method:"PUT",withCredentials:!0,params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]),angular.module("clientApp").controller("PetCtrl",["$scope","Pets","Donations","$rootScope","$routeParams","$timeout","$interval","$sce",function(a,b,c,d,e,f,g,h){d.bodyClass="pet",a.grassHeight=0,a.buttonAnimationReady=!1;var i=e.id,j=null,k=0;a.trustSrc=function(a){return h.trustAsResourceUrl(a)},b.query({id:i},function(b){a.pet=b,d.navbarTitle=b.name,a.donations=[],a.donations[0]=b,c.all({pet_id:i},function(b){f(function(){for(var c,d=0;c=b[d];d++)a.donations.push(c)}),f(function(){window.videosSwipe=new Swipe(document.getElementById("slider"),{startSlide:0,continuous:!0,disableScroll:!0,stopPropagation:!1,callback:function(){},transitionEnd:function(){}}),a.grassHeight=$(window).height()-$("#pet-pic").height()-$("#pet-pic").offset().top,a.buttonHeight=Math.min(.7*a.grassHeight,150),a.buttonMargin=(a.grassHeight-a.buttonHeight)/2},50),f(function(){j=new SuperGif({gif:document.getElementById("treat_button"),max_width:a.buttonHeight,auto_play:!1}),j.load(function(){j.pause(),k=j.get_length(),f(function(){a.buttonAnimationReady=!0})})},100)})}),a.animateButton=function(){j.play();var a=g(function(){j.get_current_frame()>=k-1&&(j.pause(),g.cancel(a))},20)},a.flip=function(){angular.element(".flipper").toggleClass("flip")},a.treats=["bone"],a.animationStatus={};for(var l in a.treats){var m=a.treats[l];a.animationStatus[m]="first"}a.startAnimation=function(b){a.animationStatus[b]="animate",f(function(){a.animationStatus[b]="last",a.showTipDialog("treat-dialog")},1200)},a.menu=[{name:"אוכל לשבוע",price:20,cart:!0,fixed:!0},{name:"עצם לעיסה קטנה",price:10},{name:"עצם לעיסה גדולה",price:20},{name:"כדור צעצוע",price:10},{name:"חבל משיכה",price:20},{name:"אמפולה נגד פשפשים",price:50},{name:"קולר נגד פשפשים",price:100}],a.totalToPay=function(){var b=0;for(var c in a.menu){var d=a.menu[c];(d.cart||d.fixed)&&(b+=d.price)}return b},window.debug=a}]),angular.module("clientApp").controller("PetsCtrl",["$scope","$rootScope","$timeout","Pets","Instagram",function(a,b,c,d){b.bodyClass="pets",b.navbarTitle="כלבים בודדים",a.pets=d.all(),window.debug=a}]),angular.module("clientApp").controller("WelcomeCtrl",["$scope","$rootScope","$cookieStore","$timeout","$location","Users",function(a,b,c,d,e,f){b.bodyClass="welcome",a.placeLogo=function(){d(function(){a.logoSpace=$(".welcome-app-explained").offset().top,a.logoHeight=(a.logoSpace-196)/2,a.logoMargin=(a.logoSpace-196)/2+"px auto",a.logoMargin=(a.logoSpace-196)/2+"px auto"})},a.fbLogin=function(){FB&&FB.login(function(a){a.authResponse?(c.put("fb_at",a.authResponse.accessToken),c.put("fb_id",a.authResponse.userID),FB.api("/me",function(a){f.create({name:a.name,email:a.email,image:"https://graph.facebook.com/"+a.username+"/picture"}),e.path("/")})):console.log("User cancelled login or did not fully authorize.")})},window.debug=a}]),angular.module("clientApp").directive("draggable",["$document",function(a){return{restrict:"A",link:function(b,c){function d(a){k=a.pageY-g+i,j=a.pageX-f+h,c.css({top:k+"px",left:j+"px"})}function e(){a.unbind("mousemove",d),a.unbind("mouseup",e)}var f=0,g=0,h=0,i=0,j=0,k=0;c.on("mousedown",function(b){b.preventDefault(),f=b.pageX,g=b.pageY,h=c.offset().left,i=c.offset().top,a.on("mousemove",d),a.on("mouseup",e)})}}}]),angular.module("clientApp").directive("tipDialog",["$timeout",function(a){return{template:'<div class="tip-dialog-container" ng-show="shown"><div class="tip-dialog-wrapper"><div class="tip-dialog animated bounce{{!leaving ? \'InDown\' : \'OutUp\'}}"><div class="rtl" ng-include="contentUrl"></div></div><div class="tip-dialog-point animated bounce{{!leaving ? \'InDown\' : \'OutUp\'}}"></div><div class="tip-dialog-dog animated bounce{{!leaving ? \'InUp\' : \'OutDown\'}}" ng-style="{backgroundImage: \'url(images/logo.png)\'}"></div><div class="tip-dialog-x animated fade{{!leaving ? \'In\' : \'Out\'}}" ng-click="closeTipDialog()"><i class="fa fa-times-circle-o"></i></div></div></div>',restrict:"E",link:function(b){b.showTipDialog=function(c){a(function(){b.contentUrl="views/partials/"+c+".html",b.shown=!0})},b.closeTipDialog=function(){b.leaving=!0,a(function(){b.shown=!1,b.leaving=!1},1e3)}}}}]),angular.module("clientApp").factory("Users",["$resource",function(a){return a(Consts.api_root+"user/:id",{},{all:{method:"GET",params:{},isArray:!0},query:{method:"GET",params:{},isArray:!1},create:{method:"POST",withCredentials:!0},update:{method:"PUT",withCredentials:!0,params:{id:"@_id"}},remove:{method:"DELETE",withCredentials:!0,params:{id:"@_id"}}})}]),angular.module("clientApp").factory("Donations",["$resource",function(a){return a(Consts.api_root+"donation/:id",{},{all:{method:"GET",withCredentials:!0,params:{},isArray:!0},query:{method:"GET",withCredentials:!0,params:{},isArray:!1},create:{method:"POST"},update:{method:"PUT",withCredentials:!0,params:{id:"@_id"}},remove:{method:"DELETE",params:{id:"@_id"}}})}]);